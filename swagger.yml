openapi: 3.1.0
info:
  title: MMC Gait Assessment API
  version: "1.0.0"
  description: |
    ## MMC Gait Project ‚Äì API Documentation

    This API defines the services powering the MMC Gait Assessment System,
    which supports full patient flow through a walk test involving photogates,
    synchronized Orbbec cameras, and real-time processing.

    ### üß≠ System Components

    #### üñ•Ô∏è Kiosk (Patient-Facing)
    - QR/manual ID input
    - Sends ID to Relay (for tagging)
    - Displays system readiness + instructions
    - Begins test after first photogate triggers
    - Shows raw output after test

    #### üß† Relay Server (Coordinator)
    - Starts/stops cameras
    - Tracks photogates via DAQ
    - Orchestrates system state
    - Sends/receives data from Kiosk + Visionary

    #### üß¨ Visionary Server (Processor)
    - Processes raw gait footage
    - Sends back structured gait data

    ### ‚úÖ Demo Flow
    1. **Check-in** via Kiosk
    2. **Relay arms system**
    3. **Cameras + DAQ capture** triggered by photogates
    4. **Visionary processes gait**
    5. **Relay returns output** to Kiosk

    ### üì¶ API Domains
    - **Kiosk**: Assessment check-in, state display, data receipt
    - **Relay**: Start/stop coordination, central status tracking
    - **Visionary**: Raw data ingestion and analytics

servers:
  - url: http://localhost

tags:
  - name: Kiosk
    description: Patient-facing interface and display
  - name: Relay
    description: Central coordinator of assessment hardware
  - name: Visionary
    description: Handles camera data processing and result return

paths:
  /kiosk/assessment/store:
    post:
      tags: [Kiosk]
      summary: Store local assessment data
      operationId: storeAssessmentKiosk
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Assessment'
      responses:
        '200':
          description: Assessment stored successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string

  /kiosk/assessment/status:
    get:
      tags: [Kiosk]
      summary: Get current assessment status for a patient
      operationId: getAssessmentStatus
      parameters:
        - name: patient_id
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Current assessment status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [not_started, in_progress, processing, completed]
                  current_step:
                    type: string

  /relay/assessment/prepare:
    post:
      tags: [Relay]
      summary: Prepare for patient assessment coordination
      operationId: prepareForAssessment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                patient_id:
                  type: string
              required: [patient_id]
      responses:
        '200':
          description: Preparation successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  prepared:
                    type: boolean
                  next_step:
                    type: string

  /relay/assessment/store:
    post:
      tags: [Relay]
      summary: Store assessment after processing (from Visionary)
      operationId: storeAssessmentRelay
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Assessment'
      responses:
        '200':
          description: Assessment stored successfully by Relay
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  stored_at:
                    type: string
                    format: date-time

  /visionary/assessment/process:
    post:
      tags: [Visionary]
      summary: Process camera-based assessment (e.g., gait analysis)
      operationId: processCameraAssessment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CameraDataInput'
      responses:
        '200':
          description: Assessment processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Assessment'

components:
  schemas:
    Patient:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
          enum: [waiting, in_progress, completed]
      required: [id, status]

    Assessment:
      type: object
      properties:
        id:
          type: string
        patient_id:
          type: string
        data:
          type: object
          description: Arbitrary assessment results or metadata
          additionalProperties: true
      required: [patient_id, data]

    CameraDataInput:
      type: object
      properties:
        patient_id:
          type: string
        start_time:
          type: string
          format: date-time
        stop_time:
          type: string
          format: date-time
      required: [patient_id, start_time, stop_time]

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
